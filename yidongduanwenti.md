
## 二、移动端无障碍

　　目前，移动设备给用户带来越来越多的便利，极大地丰富了用户的生活。移动设备的无障碍对于用户来说，尤其是以视障群体的残障用户来说，极为重要，这关系到他们是否可以公平的享受到社会进步、科学技术带来的便利。据统计，国内移动端系统占有率最高的是android和ios，因此，对android和ios移动设备与应用进行无障碍优化对于提高移动设备的无障碍比率，便捷用户使用与生活，有重要的意义。<br/>
　　本章节首先提供android和ios的无障碍设计指南，然后就移动端的无障碍问题进行描述，并提供了无障碍问题的可能原因及修改建议，指导开发者进行无障碍开发。<br/>

### 2.1焦点

背景描述：<br/>
　　*自从小朱女朋友知道小朱给自己买了裙子以后，可高兴了，小朱同学都被感染，觉得生活明媚多了。某天，小朱同学正在外和朋友吃饭，女朋友电话到了，女朋友很高兴的问裙子到了没有。小朱同学支支吾吾的说没有，小朱女朋友瞬间阴天了，让小朱查查为什么还没有到。小朱同学认命的拿出手机，在手机读屏软件的帮助下，使用购物网站的app。小朱同学使用左划、右划、触摸各种方式，就是找不到个人订单的入口。拿给朋友一看，原来个人订单没有焦点，在没开读屏的时候可以点击，开着读屏根本没有焦点，小朱同学只能请朋友帮忙点击。此处的焦点是指在屏幕阅读器可以读取的视图或控件元素。在屏幕阅读器打开的状态下，焦点周围会有边框显示。可以获得焦点的元素，就可以通过屏幕阅读器使用语音反馈给用户。如果视图或控件没
有焦点，那么读屏用户将不会感知到该视图或控件的存在，这严重妨碍了读屏用户对应用的使用。*<br/>
#### 2.1.1一个焦点覆盖到多个元素
![](/13.png)<br/>
图13 一个焦点覆盖到多个元素【示例】<br/>
【问题描述】<br/>
一个焦点覆盖多个元素， 当触摸或滑动到这个焦点的时候会把这个焦点覆盖的所有元素朗读出来， 触摸到这个界面的空白部分也朗读这个覆盖多个元素的焦点。<br/>
【可能原因】<br/>
【修改建议】<br/>
#### 2.1.2焦点区域大小不适当
![](/14.png)<br/>
图14 焦点区域大小不适当<br/>
【问题描述】<br/>
焦点区域过大或者过小， 影响低视力的人群获取界面信息。 焦点区域过小是指焦点区域小鱼展示的内容， 例如： 一个textview上的文字高25dip、宽20dip， 儿焦点区域才高12dip，宽10dip。 焦点区域过大是焦点区域大于展示的内容。<br/>
【可能原因】<br/>
【修改建议】<br/>
#### 2.1.3焦点顺序不符合逻辑
![](/15.png)<br/>
图15 焦点顺序不符合逻辑【示例】<br/>
【问题描述】<br/>
在界面上滑动浏览时，对象获得焦点的顺序与实际显示的顺序不一致， 例如界面上从左到右依次有一个编辑框、一个确定按钮、一个取消按钮， 当焦点在编辑框上时向右滑动一次取消按钮获得焦点就是不符合实际的逻辑顺序， 正确的焦点顺序应该是： 当编辑框聚焦的时候向右滑动一次是确定按钮聚焦，再向右滑动一次取消按钮聚焦。<br/>
【可能原因】<br/>
android:<br/>
1、 在布局xml文件中配置的焦点顺序出错；<br/>
2、 在java代码中设置焦点顺序时出错；<br/>
【修改建议】<br/>
android：
1、 在xml布局文件中用nextFocusDown(向下的下一个焦点）、nextFocusRight(向右的下一个焦点)、nextFocusLeft(向左的下一个焦点)、nextFocusUp(向上的下一个焦点)这四个属性来设置控件的焦点顺序;<br/>
2、 在java代码中可以用setNextFocusDown(向下的下一个焦点)、setNextFocusUp(向上的下一个焦点)、setNextFocusRight(向右的下一个焦点)、setNextFocusLeft(向左的下一个焦点)这四个函数来设置控件的焦点顺序;<br/>
#### 2.1.4部分控件无焦点
![](/16.png)<br/>
图16 部分控件无焦点【示例】<br/>
【问题描述】<br/>
控件无法滑动和触摸浏览， 或者控件只能触摸浏览；<br/>
【可能原因】<br/>
1、 没有给标准控件设置焦点；<br/>
2、 自定义的控件没有支持无障碍访问；<br/>
【修改建议】<br/>
android：<br/>
方案1： 在布局xml文件中设置；<br/>
在布局xml文件中把控件的android：focusable属性设置为true<br/>
方案2： 在java代码中设置；<br/>
在java代码中调用需要设置焦点的控件的setfocusable（）函数， 参数为true是获得焦点， 参数为false是不获得焦点;
方案3： 让自定义的控件支持无障碍访问；<br/>
ios：<br/>
让自定义的控件支持无障碍使用
（注： 下面的文字摘抄与《ios-accessibility-programming-guide-in-chinese》）
除了使用 Interface Builder，还可以通过两种编程方法让自定义独立视图支持无障碍使用。第一种方法是在初始化视图的时候
设置它的无障碍状态。如下面的代码片段所示：<br/>

```
@implementation MyCustomViewController
-(id)init
{
_view = [[[MyCustomView alloc] initWithFrame:CGRectZero] autorelease];
[_view setIsAccessibilityElement:YES];
/* Set attributes here. */
}```


另一种方法是实现
```
UIAccessibility协议的isAccessibilityElement方法。如下面的代码片段所示：<br/>
@implementation MyCustomView
/* Implement attribute methods here. */
-(BOOL)isAccessibilityElement
{
return YES;
}```

注意：在这两个代码片段中，都是用注释来代替真实的代码。<br/>
#### 2.1.5定时刷新导致焦点丢失
![](/17.png)<br/>
图17 定时刷新导致焦点丢失【示例】<br/>
【问题描述】<br/>
界面的局部或者整体定时进行刷新， 界面刷新之后焦点离开了刷新之前的位置， 刷新频率不快的时候会影响用户的使用效率。 刷新频率快的时候会导致用户无法正常操作此界面刷新区域的元素。<br/>
【可能原因】<br/>
【修改建议】<br/>
### 2.2浮层

背景描述：<br/>
　　*小朱同学查了个人待收货信息，发现正在派送，连忙给女朋友挂个电话，告知快到了，女朋友瞬间就乐开了花。这是小朱朋友们都吃完了，准备打车回去。小朱同学打开某滴打算打个快车回家。在屏幕阅读器的帮助下，在手机界面上找到某滴的图标，双击打开了应用。小朱同学在触摸浏览界面的时候，却出现了奇怪的现象，出现了几个奇怪提示“某滴欢迎您”“有某滴一路畅通”“跳过”等等，双击却没有反应。小朱同学暂停读屏服务，在界面上划了几下，再打开读屏服务，发现奇怪的提示就不见了。小朱同学知道这是欢迎页的浮层，小朱同学只是郁闷，什么时候读屏能屏蔽底层视图，也能在读屏开启的情况下操作呢？*<br/>
#### 2.2.1浮层不能滑动浏览
![](/18.png)<br/>
图18 浮窗不能滑动浏览【示例】<br/>
【问题描述】<br/>
当一个浮层弹出后，不能滑动浏览进入浮层内； 在浮层内不能滑动浏览浮层内的控件；<br/>
【可能原因】<br/>
2、 PopupWindow内的控件没有设置焦点；<br/>
1、 PopupWindow没有获得焦点；<br/>
【修改建议】<br/>
android：<br/>
1、 把PopupWindow内的所有控件设置焦点；<br/>
2、 给PopupWindow设置焦点；<br/>
方法1： PopupWindow初始化的时候第四个参数设置为true；<br/>
方法2： 用setFocusable()函数设置PopupWindow获得焦点， 参数是true是获得焦点，参数是false是不获得焦点。<br/>
#### 2.2.2不能屏蔽底层的焦点
![](/19.png)<br/>
图19 不能屏蔽底层的焦点【示例】<br/>
【问题描述】<br/>
当浮层弹出后用单指在界面上滑动浏览， 朗读的是浮层底的控件没有朗读浮层内的控件；<br/>
【可能原因】<br/>
【修改建议】<br/>
android：<br/>
 给PopupWindow设置焦点：<br/>
方法1： PopupWindow初始化的时候第四个参数设置为true<br/>
方法2： 用setFocusable()函数设置PopupWindow获得焦点， 参数是true是获得焦点，参数是false是不获得焦点。<br/>
#### 2.2.3浮层无法关闭
![](/20.png)<br/>
图20 浮窗无法关闭【示例】<br/>
【问题描述】<br/>
在屏幕阅读器开启的情况下， 浮层弹出后， 没有提供任何一种方式关闭浮层。<br/>
【可能原因】<br/>
【修改建议】<br/>
#### 2.2.4浮层弹出后自动朗读所有控件
![](/21.png)<br/>
图21 浮层弹出后自动朗读所有控件【示例】<br/>
【问题描述】<br/>
浮层弹出后会自动把浮层内的所有元素按顺序朗读一遍；<br/>
【可能原因】<br/>
没有给PopupWindow设置背景；<br/>
【修改建议】<br/>
android：<br/>
使用setBackgroundDrawable（）函数设置背景，为了不改变视觉效果可以使用下面的两种方式：<br/>
setBackgroundDrawable(new BitmapDrawable());<br/><br/>
setBackgroundDrawable(new ColorDrawable(0x00000000))。<br/>
### 2.3提示文本

背景描述：<br/>
　　*小朱同学纠结完浮层的问题之后，小朱同学开始滑动浏览界面上，却听到一些“按钮77”“按钮64 未加标签”“按钮99 未加标签”的提示，在选车的时候也没有提示控件类型，无法得知车型是否已选择。提示文本是屏幕阅读器可以提取，并通过语音反馈给用户的说明性文本，包括控件类型、操作目的等内容，要求提示文本简介明了，但有很多控件的控件类型不提示、目的文本为乱码，也有冗余的现象。根据使用经验，小朱同学还是顺利打到车回到家。但是小朱同学希望，更多的互联网产品可以进行无障碍优化。身为视障工程师，小朱不认为是命运不公，却也总希望能为自己公平的享受现代科技带来的便利。*<br/>
#### 2.3.1没有提示文本
![](/22.png)<br/>
图22 没有提示文本【示例】<br/>
【问题描述】<br/>
控件没有提示文本， 用户无法知道此控件是做什么的。 有几种表现：<br/> 1、 控件能获得焦点但是不读任何信息， 如邮箱大师添加邮箱的qq邮箱。<br/> 2、 控件获得焦点只朗读控件类型，如朗读为：”按钮“、 ”x未标记的按钮“（x是一个随机数）。<br/>
【可能原因】<br/>
1、 android<br/>
图形按钮没有添加contentdescription属性；<br/>
2、 ios<br/>
图形按钮没有添加标签或者提示；<br/>
【修改建议】<br/>
1、android：<br/>
给图形按钮添加contentdescription属性并给此属性赋适当的值；<br/>
2、 ios<br/>
给图形按钮添加标签和提示属性；
#### 2.3.2提示文本有乱码
![](/23.png)<br/>
图23 提示文本有乱码【示例】<br/>
【问题描述】<br/>
控件获得焦点的时候， 控件的提示文本朗读为乱码、 朗读控件提示文本之前朗读一段乱码、 提示文本的尾部有一段乱码或者在提示文本中间有乱码。<br/>
【可能原因】<br/>
【修改建议】<br/>
#### 2.3.3控件类型不能正常朗读
![](/24.png)<br/>
图24 空间类型不能正常朗读【示例】<br/>
【问题描述】<br/>
控件的类型不提示或者控件类型提示不正确， 用户不知道如何操作此控件， 这种情况主要出现在自定义控件上；<br/>
【可能原因】<br/>
自定义控件的无障碍支持不全面；<br/>
【修改建议】<br/>
android：<br/>
在任何一种情况下，为您的自定义视图类您应该执行下面的可访问性方法：<br/>
```
dispatchPopulateAccessibilityEvent()
onPopulateAccessibilityEvent()
onInitializeAccessibilityEvent()
onInitializeAccessibilityNodeInfo()```

通常是在onInitializeAccessibilityEvent() 方法中提供类名（控件类型）。<br/>
#### 2.3.4提示文本有冗余信息、 提示文本错误
![](/25.png)<br/>
图25 提示文本有冗余信息【示例】<br/>
【问题描述】<br/>
控件的提示文本有冗余； 控件的提示文本与控件的实际目的不相符；<br/>
【可能原因】<br/>
1.	给控件提供提示文本或替代文本时文本不够精炼准；<br/>
2.	提供了一些不必要的信；<br/>
【修改建议】<br/>
1、给控件提供文本或者替代文本时要精炼准确；<br/>
2、去掉这些不必要的信息。<br/>
